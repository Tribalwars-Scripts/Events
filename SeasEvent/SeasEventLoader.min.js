const unlockButtons=()=>{const unlockX=ID=>{document.getElementById(ID).classList.remove("btn-disabled")};const handleEventButtons=[UIIds.setPrefsId,UIIds.resetPrefsId,UIIds.startButtonId,UIIds.setEventSettingsId];handleEventButtons.forEach(e=>unlockX(e));document.getElementById(UIIds.setEventSettingsId).parentElement.children[1].textContent="General "+ScriptName+" settings."};const resetSettings=()=>{const data=getLocalStorage(StorageIds.globalData);if(data){data.EventSettings=null}printSuccess("Settings have been reset")};const saveSettings=()=>{const getSaved=getLocalStorage(StorageIds.globalData);if(getSaved===globalData){printError("Nothing to save.");return}saveLocalStorage(StorageIds.globalData,globalData);printSuccess("Settings successfully saved")};unlockButtons();const startStopBot=()=>{const savedData=getLocalStorage(StorageIds.globalData);savedData.running=!savedData.running;document.getElementById(UIIds.startButtonId).innerText=savedData.running?"Stop":"Start";saveLocalStorage(StorageIds.globalData,savedData);savedData.running?start():{}};document.getElementById(UIIds.setEventSettingsId).addEventListener("click",async function(){$.ajax({type:"GET",url:"https://rawcdn.githack.com/Tribalwars-Scripts/Events/"+ScriptVersion+"/SeasEvent/settings.min.js?min=1",dataType:"script",cache:false})});document.getElementById(UIIds.resetPrefsId).addEventListener("click",async function(){resetSettings()});document.getElementById(UIIds.setPrefsId).addEventListener("click",async function(){saveSettings()});document.getElementById(UIIds.startButtonId).addEventListener("click",async function(){startStopBot()});const start=async()=>{const saveData=getLocalStorage(StorageIds.globalData);const isStart=async()=>{const fetchDTroops=async()=>{const nextInteraction=()=>{const timestampInMilliseconds=newTime*1e3;const date=new Date(timestampInMilliseconds);const year=date.getFullYear();const month=("0"+(date.getMonth()+1)).slice(-2);const day=("0"+date.getDate()).slice(-2);const hours=("0"+date.getHours()).slice(-2);const minutes=("0"+date.getMinutes()).slice(-2);const seconds=("0"+date.getSeconds()).slice(-2);const readableTime=`${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;UI.SuccessMessage("Next daily troops on "+readableTime)};$.ajax({type:"GET",url:"https://rawcdn.githack.com/Tribalwars-Scripts/Events/"+ScriptVersion+"/SeasEvent/DailyTroops.min.js?min=1",dataType:"script",cache:false});await sleep(2e4);saveData.time=currentTime;saveData.time2=newTime;nextInteraction();saveLocalStorage(StorageIds.globalData,saveData)};const currentTime=Math.floor(Date.now()/1e3);const currentDate=new Date;currentDate.setHours(14,0,0,0);if(currentDate.getTime()<Date.now()){currentDate.setDate(currentDate.getDate()+1)}const newTime=Math.floor(currentDate.getTime()/1e3);const previousDTroops=saveData.time;const nextDTroops=saveData.time2;if(previousDTroops&&nextDTroops){if(currentTime>nextDTroops){await fetchDTroops()}}else{await fetchDTroops()}inProgress()};saveData.running?await isStart():{}};setTimeout(start,5e4);