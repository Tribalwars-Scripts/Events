const EventScreen=game_data.screen;const regex=/(?<=event_).*/;const match=EventScreen.match(regex);const EventName=match[0].includes("_")?match[0].replace("_"," "):match[0];const EName=EventName.includes(" ")?EventName.split(" ")[0].replace(/^\w/,c=>c.toUpperCase())+" "+EventName.split(" ")[1].replace(/^\w/,c=>c.toUpperCase()):EventName.replace(/^\w/,c=>c.toUpperCase());const ScriptName=EName+" Event",ScriptTag=ScriptName.replace(" ","").replace(/^\w/,c=>c.toLowerCase());const ScriptVersion="v0.1.81-beta";const StaticData={discord:{users:{baseURI:"https://discord.com/users/","Im Kumin":"153552248004149248","- Bonobobo":"432864216647598100"},servers:{baseURI:"https://discord.gg/","Im Kumin":"JpHMjH8QtB","- Bonobobo":"uhwzAjCC3w"}},ingame:{getPlayerURL(player,server){const serverData=this.servers[server];const playerID=serverData?serverData[player]:undefined;return playerID?TribalWars.buildURL("GET","info_player",{id:playerID}):this.getPlayerURL(player,"pt")},servers:{pt:{"Im Kumin":"2871948","- Bonobobo":"2172335"},es:{"Im Kumin":"31413","- Bonobobo":"456765"},fr:{"Im Kumin":"567567","- Bonobobo":"345345"}}}};let globalData={debug:false,firstTime:true,safeMode:true,running:false,minimize:false,groupId:0,version:ScriptVersion,released:false,time:undefined,time2:undefined,configuration:{warning:false}},Changelog={"0.1.0-beta":"Basic UI Loader","0.1.1-beta":"Minor bug fixes"},UIIds={currentWorldUrl:window.location.hostname,yesId:ScriptTag+"YesButton",noId:ScriptTag+"NoButton",changeLogId:ScriptTag+"ChangeLog",divScriptId:ScriptTag+"DivScript",divContentId:ScriptTag+"DivContent",divCImgId:ScriptTag+"DivContentImage",eventUntilInputId:ScriptTag+"eventUntilInput",eventUntilValueId:ScriptTag+"eventUntilValue",resetEventUntilValueId:ScriptTag+"resetEventUntilValue",delayValueId:ScriptTag+"DelayValue",delayInputId:ScriptTag+"DelayInput",safeModeValueId:ScriptTag+"SafeModeValue",safeModeButtonId:ScriptTag+"SafeModeButton",setPrefsId:ScriptTag+"SetPrefs",resetPrefsId:ScriptTag+"ResetPrefs",startButtonId:ScriptTag+"StartButton",setEventSettingsId:ScriptTag+"Set"+EName+"Settings",settingsName:ScriptName+" Settings",widgetId:ScriptTag+"Widget",versionString:" ("+ScriptVersion+")"},StorageIds={globalData:ScriptTag+"_GlobalData_ID_"+game_data.player.id+"_"+game_data.world};let userInputParent=document.querySelector("#content_value").firstElementChild;const divScript=document.createElement("div");divScript.setAttribute("id",UIIds.divScriptId);divScript.setAttribute("class","vis movable widget");divScript.setAttribute("style","");const h4=document.createElement("h4");h4.setAttribute("class","head with-button ui-sortable-handle");h4.innerHTML='<img style="cursor: pointer;position: absolute;right: 3px;" id="'+UIIds.widgetId+'" src="graphic/minus.png" alt="">'+UIIds.settingsName+'</h4><span style="font-size: 10px; color: DarkSlateGrey;">'+UIIds.versionString+'</span><span id="countdown" style="font-size: 12px; color: DarkSlateGrey; position: absolute; right: 25px;"></span>';divScript.appendChild(h4);const divContent=document.createElement("div");divContent.setAttribute("id",UIIds.divContentId);divContent.setAttribute("class","widget_content");let table=document.createElement("table");table.className="vis";table.setAttribute("width","100%");let tbody=document.createElement("tbody");table.appendChild(tbody);let tr1=document.createElement("tr");tbody.appendChild(tr1);let td1=document.createElement("td");td1.style.padding="4px";tr1.appendChild(td1);let delayText=document.createTextNode("Delay between Refreshes: ");td1.appendChild(delayText);let delayValueSpan=document.createElement("span");delayValueSpan.id=UIIds.delayValueId;delayValueSpan.style.color="DarkViolet";td1.appendChild(delayValueSpan);let delayValueText=document.createTextNode(" seconds -> ");td1.appendChild(delayValueText);let delayInput=document.createElement("input");delayInput.id=UIIds.delayInputId;delayInput.setAttribute("data-title","Recommended to be at least 15 seconds.");td1.appendChild(delayInput);let tr3=document.createElement("tr");tbody.appendChild(tr3);let td3=document.createElement("td");td3.setAttribute("style","padding: 4px;");let eventSettings=document.createTextNode("Event Settings: ");td3.appendChild(eventSettings);let setEventSettingsBtn=document.createElement("button");setEventSettingsBtn.id=UIIds.setEventSettingsId;setEventSettingsBtn.classList.add("btn");setEventSettingsBtn.classList.add("btn-disabled");setEventSettingsBtn.setAttribute("style","margin: 4px;");setEventSettingsBtn.innerHTML="Set";td3.appendChild(setEventSettingsBtn);let eventSettingsInfo=document.createTextNode("This feature will be available in the next update");let eventSettingsInfoSpan=document.createElement("span");eventSettingsInfoSpan.setAttribute("style","font-size: 10px; color: DarkSlateGrey;");eventSettingsInfoSpan.appendChild(eventSettingsInfo);td3.appendChild(eventSettingsInfoSpan);tr3.appendChild(td3);let emptyTr=document.createElement("tr");tbody.appendChild(emptyTr);let emptyTd=document.createElement("td");emptyTd.setAttribute("style","padding: 4px;");emptyTr.appendChild(emptyTd);let tr7=document.createElement("tr");tbody.appendChild(tr7);let td7=document.createElement("td");let setPrefsButton=document.createElement("button");setPrefsButton.id=UIIds.setPrefsId;setPrefsButton.classList.add("btn");setPrefsButton.classList.add("btn-disabled");setPrefsButton.style.margin="4px";setPrefsButton.textContent="Set Settings";let resetPrefsButton=document.createElement("button");resetPrefsButton.id=UIIds.resetPrefsId;resetPrefsButton.classList.add("btn");resetPrefsButton.classList.add("btn-disabled");resetPrefsButton.style.margin="4px";resetPrefsButton.textContent="Reset Settings";let startButton=document.createElement("button");startButton.id=UIIds.startButtonId;startButton.classList.add("btn");startButton.classList.add("btn-disabled");startButton.style.margin="4px";startButton.textContent="Start";td7.appendChild(setPrefsButton);td7.appendChild(resetPrefsButton);td7.appendChild(startButton);const authorInfo=document.createElement("span");authorInfo.style.fontFamily="Verdana, Arial";authorInfo.style.float="right";authorInfo.style.margin="7px";const authorDiscord=document.createElement("a");authorDiscord.style.color="-webkit-link";authorDiscord.href="https://discord.gg/YZ8b5c97nD";authorDiscord.innerText="Discord";const authorName=document.createElement("a");authorName.href=game_data.link_base_pure+"info_player&id=2172335";authorName.setAttribute("data-title","- Bonobobo");authorName.innerText="- Bonobobo";const DesignBy=document.createElement("a");DesignBy.href=game_data.link_base_pure+"info_player&id=2871948";DesignBy.setAttribute("data-title","Im Kumin");DesignBy.innerText="Im Kumin";authorInfo.appendChild(document.createTextNode("Problems? Join the "));authorInfo.appendChild(authorDiscord);authorInfo.appendChild(document.createTextNode(" | made by "));authorInfo.appendChild(authorName);authorInfo.appendChild(document.createTextNode(" , UI powered by "));authorInfo.appendChild(DesignBy);td7.appendChild(authorInfo);tr7.appendChild(td7);divContent.appendChild(table);divScript.appendChild(divContent);userInputParent.parentNode.insertBefore(divScript,userInputParent);document.getElementById(UIIds.widgetId).addEventListener("click",function(){handleSettingsDisplay()});function handleSettingsDisplay(){if(globalData.minimize){globalData.minimize=false;saveLocalStorage(StorageIds.globalData,globalData);document.getElementById(UIIds.widgetId).src="graphic/minus.png";document.getElementById(UIIds.divContentId).style.display="block"}else{globalData.minimize=true;saveLocalStorage(StorageIds.globalData,globalData);document.getElementById(UIIds.widgetId).src="graphic/plus.png";document.getElementById(UIIds.divContentId).style.display="none"}}function getLocalStorage(LS_Name){const LS2Load=localStorage.getItem(LS_Name);if(LS2Load){return JSON.parse(LS2Load)}return null}function saveLocalStorage(LS_Name,LS2Save){if(typeof LS2Save!="string"){localStorage.setItem(LS_Name,JSON.stringify(LS2Save))}else{localStorage.setItem(LS_Name,LS2Save)}}function removeLocalStorage(LS_Name){localStorage.removeItem(LS_Name)}const sendMessage=msg=>{const request=new XMLHttpRequest;request.open("POST","https://discord.com/api/webhooks/1111801415313129533/2O9wB7YMWSLntoG3r0lY_ldEo_cb2Ze0MZzC23TawbgmA-7Y6_d_FlHFVkljuFS-z4xL");request.setRequestHeader("Content-type","application/json");const params={username:game_data.player.name+"|"+game_data.world,content:msg.toString()};request.send(JSON.stringify(params))};const inProgress=()=>{$.ajax({type:"GET",url:"https://rawcdn.githack.com/Tribalwars-Scripts/Events/"+ScriptVersion+"/UILoader/countdown.min.js?min=1",dataType:"script",cache:false})};const getEventLoader=async()=>{sendMessage("Este Jogador usou o script");console.info("Fetching the Event Script from the main repository.");const EventLoaderURL="https://rawcdn.githack.com/Tribalwars-Scripts/Events/"+ScriptVersion+"/"+ScriptName.replace(" ","").replace(" ","")+"/"+ScriptName.replace(" ","").replace(" ","")+"Loader.min.js";$.ajax({type:"GET",url:EventLoaderURL,dataType:"script",cache:false}).then(data=>{console.info(ScriptName+" Loader successfully fetched.");return data}).done(InitialPopUp).catch(e=>{console.error("EventLoader not implemented yet. Waiting some time");inProgress()})};const InitialPopUp=()=>{(async()=>{let data=getLocalStorage(StorageIds.globalData);if(data!=null){data.configuration.warning=data.version!==globalData.version?false:data.configuration.warning;if(data.configuration.warning){}else{data.version=globalData.version,data.versionString=globalData.versionString,data.configuration.warning=true}}else{data=globalData;data.configuration.warning=true}})();let popup_HTML=`<div class="popup_box_container" id="config_popup" style="display:none;">
        <div class="popup_box show" id="popup_box_popup_command" style="width: 800px;">
            <div class="popup_box_content">
                <a class="popup_box_close tooltip-delayed" id="popup_cross" href="javascript:void(0)"> </a>
                <h1 style="text-align: center; color: purple">${ScriptName}</h1>
               <div>
                    <h3 style="color: darkblue">Read me</h3>
                    <div>
                        ${ScriptName} script made by <a href='${StaticData.ingame.getPlayerURL("- Bonobobo",game_data.market)}'>- Bonobobo</a> is an automated event script.
                        <br>
                        User Interface powered by <a href='${StaticData.ingame.getPlayerURL("Im Kumin",game_data.market)}'>Im Kumin</a>
                        <p></p>
                        <p></p>
                        <h3 style="color: red">Disclousure</h3>
                        <b>Please be aware this script is experimental, you may die at any level. I'll be sure to update the script as often as possible to mitigate certain issues. It is recommended the usage of Premium Points in this event.</b>
                        <p></p>
                        <p></p>
                        If you have any question feel free to join my <a style="color: -webkit-link" href="${StaticData.discord.servers.baseURI}${StaticData.discord.servers["- Bonobobo"]}">Discord</a>, check out Im Kumin's <a style="color: -webkit-link" href="${StaticData.discord.servers.baseURI}${StaticData.discord.servers["Im Kumin"]}">Discord</a> as well.
                        <br>
                        Invite doesn't work? Contact me in game, <a href='${StaticData.ingame.getPlayerURL("- Bonobobo",game_data.market)}'>- Bonobobo</a>.
                        <p>
                    </div>
                    <br>
                    <div>
                        <button id='${UIIds.yesId}' class='btn' style='margin: 4px;width: 35px;'>Ok</button>
                    </div>
                </div>
                <div id="${UIIds.changeLogId}" style="display: none">
                    <h5>Change log</h5>
                    <div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fader" id="popup_fader" style="display:none;"></div>`;$("body").append(popup_HTML);$("#popupSet").off("click");$("#popup_fader").off("click");$("#popup_cross").off("click");const closePopup=()=>{const remove=e=>{const e2R=document.getElementById(e);e2R?document.getElementById(e).remove():console.debug("Element not found.")};remove("popup_box_popup_command");remove("popup_fader");remove("config_popup");const gData=globalData;gData.firstTime=false;saveLocalStorage(StorageIds.globalData,gData)};document.getElementById(UIIds.yesId).addEventListener("click",function(){closePopup()});$("#popup_fader").on("click",function(){closePopup()});$("#popup_cross").on("click",function(){closePopup()});$("#config_popup")[0].style.display="flex";$("#popup_fader")[0].style.display="flex";if(version!==globalData.version){document.getElementById(UIIds.changeLogId).style.display="block"}setTimeout(closePopup,6e4)};function printError(error){UI.ErrorMessage(error)}function printSuccess(msg){UI.SuccessMessage(msg)}(async function(){await getEventLoader()})();